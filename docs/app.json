[{"name": "app.py", "content": "from shiny import App, reactive, render, ui\n\n# TODO Add Bhatkhande Notation\n\nUMAMI_SCRIPT = \"\"\"\n  <script \n    async \n    src=\"https://umami-two-rouge.vercel.app/script.js\" \n    data-website-id=\"7774b7f7-ec77-4fa0-b9c8-be5df3ee6ad5\"\n    data-domains=\"pamitabh.github.io/indian-classical-music-practice\"\n  ></script>\n\"\"\"\n\ndef komal(text):\n    return \"\".join(f\"<u>{char}</u>\" if char not in [' ', '.'] else char for char in text)\ndef tivra(text):\n    return f\"{text}\\'\"\n\nTHAAT_SWAR_DEVANAGRI_DICT = {\n    'Bilawal thaat': [\".\u0938\u093e \",\".\u0930\u0947 \",\".\u0917\u093e \",\".\u092e \",\".\u092a \",\".\u0927 \",\".\u0928\u093f \",\" \u0938\u093e \",\" \u0930\u0947 \",\" \u0917\u093e \",\" \u092e \",\" \u092a \",\" \u0927 \",\" \u0928\u093f \",\" \u0938\u093e.\",\" \u0930\u0947.\",\" \u0917\u093e.\",\" \u092e.\",\" \u092a.\",\" \u0927.\",\" \u0928\u093f.\",\" \u0938\u093e..\"],\n    'Kalyan thaat': [\".\u0938\u093e \",\".\u0930\u0947 \",\".\u0917\u093e \",\".\u092e' \",\".\u092a \",\".\u0927 \",\".\u0928\u093f \",\" \u0938\u093e \",\" \u0930\u0947 \",\" \u0917\u093e \",\" \u092e' \",\" \u092a \",\" \u0927 \",\" \u0928\u093f \",\" \u0938\u093e.\",\" \u0930\u0947.\",\" \u0917\u093e.\",\" \u092e'.\",\" \u092a.\",\" \u0927.\",\" \u0928\u093f.\",\" \u0938\u093e..\"],\n    'Khamaj thaat': [\".\u0938\u093e \",\".\u0930\u0947 \",\".\u0917\u093e \",\".\u092e \",\".\u092a \",\".\u0927 \",komal(\".\u0928\u093f \"),\" \u0938\u093e \",\" \u0930\u0947 \",\" \u0917\u093e \",\" \u092e \",\" \u092a \",\" \u0927 \",komal(\" \u0928\u093f \"),\" \u0938\u093e.\",\" \u0930\u0947.\",\" \u0917\u093e \",\" \u092e.\",\" \u092a.\",\" \u0927.\",komal(\" \u0928\u093f.\"),\" \u0938\u093e..\"], \n    'Kafi thaat': [\".\u0938\u093e \",\".\u0930\u0947 \",komal(\".\u0917\u093e \"),\".\u092e \",\".\u092a \",\".\u0927 \",komal(\".\u0928\u093f \"),\" \u0938\u093e \",\" \u0930\u0947 \",komal(\" \u0917\u093e \"),\" \u092e \",\" \u092a \",\" \u0927 \",komal(\" \u0928\u093f \"),\" \u0938\u093e.\",\" \u0930\u0947.\",komal(\" \u0917\u093e.\"),\" \u092e.\",\" \u092a.\",\" \u0927.\",komal(\" \u0928\u093f.\"),\" \u0938\u093e..\"],\n    'Asavari thaat': [\".\u0938\u093e \",\".\u0930\u0947 \",komal(\".\u0917\u093e \"),\".\u092e \",\".\u092a \",komal(\".\u0927 \"),komal(\".\u0928\u093f \"),\" \u0938\u093e \",\" \u0930\u0947 \",komal(\" \u0917\u093e \"),\" \u092e \",\" \u092a \",komal(\" \u0927 \"),komal(\" \u0928\u093f \"),\" \u0938\u093e.\",\" \u0930\u0947.\",komal(\" \u0917\u093e.\"),\" \u092e.\",\" \u092a.\",komal(\" \u0927.\"),komal(\" \u0928\u093f.\"),\" \u0938\u093e..\"],\n    'Bhairavi thaat': [\".\u0938\u093e \",komal(\".\u0930\u0947 \"),komal(\".\u0917\u093e \"),\".\u092e \",\".\u092a \",komal(\".\u0927 \"),komal(\".\u0928\u093f \"),\" \u0938\u093e \",komal(\" \u0930\u0947 \"),komal(\" \u0917\u093e \"),\" \u092e \",\" \u092a \",komal(\" \u0927 \"),komal(\" \u0928\u093f \"),\" \u0938\u093e.\",komal(\" \u0930\u0947.\"),komal(\" \u0917\u093e.\"),\" \u092e.\",\" \u092a.\",komal(\" \u0927.\"),komal(\" \u0928\u093f.\"),\" \u0938\u093e..\"],\n    'Bhairav thaat': [\".\u0938\u093e \",komal(\".\u0930\u0947 \"),\".\u0917\u093e \",\".\u092e \",\".\u092a \",komal(\".\u0927 \"),\".\u0928\u093f \",\" \u0938\u093e \",komal(\" \u0930\u0947 \"),\" \u0917\u093e \",\" \u092e \",\" \u092a \",komal(\" \u0927 \"),\" \u0928\u093f \",\" \u0938\u093e.\",komal(\" \u0930\u0947.\"),\" \u0917\u093e.\",\" \u092e.\",\" \u092a.\",komal(\" \u0927.\"),\" \u0928\u093f.\",\" \u0938\u093e..\"],\n    'Marwa thaat': [\".\u0938\u093e \",komal(\".\u0930\u0947 \"),\".\u0917\u093e \",\".\u092e' \",\".\u092a \",\".\u0927 \",\".\u0928\u093f \",\" \u0938\u093e \",komal(\" \u0930\u0947 \"),\" \u0917\u093e \",\" \u092e' \",\" \u092a \",\" \u0927 \",\" \u0928\u093f \",\" \u0938\u093e.\",komal(\" \u0930\u0947.\"),\" \u0917\u093e.\",\" \u092e'.\",\" \u092a.\",\" \u0927.\",\" \u0928\u093f.\",\" \u0938\u093e..\"],\n    'Purvi thaat': [\".\u0938\u093e \",komal(\".\u0930\u0947 \"),\".\u0917\u093e \",\".\u092e' \",\".\u092a \",komal(\".\u0927 \"),\".\u0928\u093f \",\" \u0938\u093e \",komal(\" \u0930\u0947 \"),\" \u0917\u093e \",\" \u092e' \",\" \u092a \",komal(\" \u0927 \"),\" \u0928\u093f \",\" \u0938\u093e.\",komal(\" \u0930\u0947.\"),\" \u0917\u093e.\",\" \u092e'.\",\" \u092a.\",komal(\" \u0927.\"),\" \u0928\u093f.\",\" \u0938\u093e..\"],\n    'Todi thaat': [\".\u0938\u093e \",komal(\".\u0930\u0947 \"),komal(\".\u0917\u093e \"),\".\u092e' \",\".\u092a \",komal(\".\u0927 \"),\".\u0928\u093f \",\" \u0938\u093e \",komal(\" \u0930\u0947 \"),komal(\" \u0917\u093e \"),\" \u092e' \",\" \u092a \",komal(\" \u0927 \"),\" \u0928\u093f \",\" \u0938\u093e.\",komal(\" \u0930\u0947.\"),komal(\" \u0917\u093e.\"),\" \u092e'.\",\" \u092a.\",komal(\" \u0927.\"),\" \u0928\u093f.\",\" \u0938\u093e..\"], \n}\n\nTHAAT_SWAR_DEVANAGRI_SIMPLIFIED_DICT = {\n    'Bilawal thaat': [\".\u0938 \",\".\u0930 \",\".\u0917 \",\".\u092e \",\".\u092a \",\".\u0927 \",\".\u0928 \",\" \u0938 \",\" \u0930 \",\" \u0917 \",\" \u092e \",\" \u092a \",\" \u0927 \",\" \u0928 \",\" \u0938.\",\" \u0930.\",\" \u0917.\",\" \u092e.\",\" \u092a.\",\" \u0927.\",\" \u0928.\",\" \u0938..\"],\n    'Kalyan thaat': [\".\u0938 \",\".\u0930 \",\".\u0917 \",\".\u092e' \",\".\u092a \",\".\u0927 \",\".\u0928 \",\" \u0938 \",\" \u0930 \",\" \u0917 \",\" \u092e' \",\" \u092a \",\" \u0927 \",\" \u0928 \",\" \u0938.\",\" \u0930.\",\" \u0917.\",\" \u092e'.\",\" \u092a.\",\" \u0927.\",\" \u0928.\",\" \u0938..\"],\n    'Khamaj thaat': [\".\u0938 \",\".\u0930 \",\".\u0917 \",\".\u092e \",\".\u092a \",\".\u0927 \",komal(\".\u0928 \"),\" \u0938 \",\" \u0930 \",\" \u0917 \",\" \u092e \",\" \u092a \",\" \u0927 \",komal(\" \u0928 \"),\" \u0938.\",\" \u0930.\",\" \u0917 \",\" \u092e.\",\" \u092a.\",\" \u0927.\",komal(\" \u0928.\"),\" \u0938..\"], \n    'Kafi thaat': [\".\u0938 \",\".\u0930 \",komal(\".\u0917 \"),\".\u092e \",\".\u092a \",\".\u0927 \",komal(\".\u0928 \"),\" \u0938 \",\" \u0930 \",komal(\" \u0917 \"),\" \u092e \",\" \u092a \",\" \u0927 \",komal(\" \u0928 \"),\" \u0938.\",\" \u0930.\",komal(\" \u0917.\"),\" \u092e.\",\" \u092a.\",\" \u0927.\",komal(\" \u0928.\"),\" \u0938..\"],\n    'Asavari thaat': [\".\u0938 \",\".\u0930 \",komal(\".\u0917 \"),\".\u092e \",\".\u092a \",komal(\".\u0927 \"),komal(\".\u0928 \"),\" \u0938 \",\" \u0930 \",komal(\" \u0917 \"),\" \u092e \",\" \u092a \",komal(\" \u0927 \"),komal(\" \u0928 \"),\" \u0938.\",\" \u0930.\",komal(\" \u0917.\"),\" \u092e.\",\" \u092a.\",komal(\" \u0927.\"),komal(\" \u0928.\"),\" \u0938..\"],\n    'Bhairavi thaat': [\".\u0938 \",komal(\".\u0930 \"),komal(\".\u0917 \"),\".\u092e \",\".\u092a \",komal(\".\u0927 \"),komal(\".\u0928 \"),\" \u0938 \",komal(\" \u0930 \"),komal(\" \u0917 \"),\" \u092e \",\" \u092a \",komal(\" \u0927 \"),komal(\" \u0928 \"),\" \u0938.\",komal(\" \u0930.\"),komal(\" \u0917.\"),\" \u092e.\",\" \u092a.\",komal(\" \u0927.\"),komal(\" \u0928.\"),\" \u0938..\"],\n    'Bhairav thaat': [\".\u0938 \",komal(\".\u0930 \"),\".\u0917 \",\".\u092e \",\".\u092a \",komal(\".\u0927 \"),\".\u0928 \",\" \u0938 \",komal(\" \u0930 \"),\" \u0917 \",\" \u092e \",\" \u092a \",komal(\" \u0927 \"),\" \u0928 \",\" \u0938.\",komal(\" \u0930.\"),\" \u0917.\",\" \u092e.\",\" \u092a.\",komal(\" \u0927.\"),\" \u0928.\",\" \u0938..\"],\n    'Marwa thaat': [\".\u0938 \",komal(\".\u0930 \"),\".\u0917 \",\".\u092e' \",\".\u092a \",\".\u0927 \",\".\u0928 \",\" \u0938 \",komal(\" \u0930 \"),\" \u0917 \",\" \u092e' \",\" \u092a \",\" \u0927 \",\" \u0928 \",\" \u0938.\",komal(\" \u0930.\"),\" \u0917.\",\" \u092e'.\",\" \u092a.\",\" \u0927.\",\" \u0928.\",\" \u0938..\"],\n    'Purvi thaat': [\".\u0938 \",komal(\".\u0930 \"),\".\u0917 \",\".\u092e' \",\".\u092a \",komal(\".\u0927 \"),\".\u0928 \",\" \u0938 \",komal(\" \u0930 \"),\" \u0917 \",\" \u092e' \",\" \u092a \",komal(\" \u0927 \"),\" \u0928 \",\" \u0938.\",komal(\" \u0930.\"),\" \u0917.\",\" \u092e'.\",\" \u092a.\",komal(\" \u0927.\"),\" \u0928.\",\" \u0938..\"],\n    'Todi thaat': [\".\u0938 \",komal(\".\u0930 \"),komal(\".\u0917 \"),\".\u092e' \",\".\u092a \",komal(\".\u0927 \"),\".\u0928 \",\" \u0938 \",komal(\" \u0930 \"),komal(\" \u0917 \"),\" \u092e' \",\" \u092a \",komal(\" \u0927 \"),\" \u0928 \",\" \u0938.\",komal(\" \u0930.\"),komal(\" \u0917.\"),\" \u092e'.\",\" \u092a.\",komal(\" \u0927.\"),\" \u0928.\",\" \u0938..\"], \n}\n\nTHAAT_SWAR_LATIN_DICT = {\n    'Bilawal thaat': [\".S \",\".R \",\".G \",\".M \",\".P \",\".D \",\".N \",\" S \",\" R \",\" G \",\" M \",\" P \",\" D \",\" N \",\" S.\",\" R.\",\" G.\",\" M.\",\" P.\",\" D.\",\" N.\",\" S..\"],\n    'Kalyan thaat': [\".S \",\".R \",\".G \",\".M' \",\".P \",\".D \",\".N \",\" S \",\" R \",\" G \",\" M' \",\" P \",\" D \",\" N \",\" S.\",\" R.\",\" G.\",\" M'.\",\" P.\",\" D.\",\" N.\",\" S..\"],\n    'Khamaj thaat': [\".S \",\".R \",\".G \",\".M \",\".P \",\".D \",komal(\".N \"),\" S \",\" R \",\" G \",\" M \",\" P \",\" D \",komal(\" N \"),\" S.\",\" R.\",\" G \",\" M.\",\" P.\",\" D.\",komal(\" N.\"),\" S..\"],\n    'Kafi thaat': [\".S \",\".R \",komal(\".G \"),\".M \",\".P \",\".D \",komal(\".N \"),\" S \",\" R \",komal(\" G \"),\" M \",\" P \",\" D \",komal(\" N \"),\" S.\",\" R.\",komal(\" G.\"),\" M.\",\" P.\",\" D.\",komal(\" N.\"),\" S..\"],\n    'Asavari thaat': [\".S \",\".R \",komal(\".G \"),\".M \",\".P \",komal(\".D \"),komal(\".N \"),\" S \",\" R \",komal(\" G \"),\" M \",\" P \",komal(\" D \"),komal(\" N \"),\" S.\",\" R.\",komal(\" G.\"),\" M.\",\" P.\",komal(\" D.\"),komal(\" N.\"),\" S..\"],\n    'Bhairavi thaat': [\".S \",komal(\".R \"),komal(\".G \"),\".M \",\".P \",komal(\".D \"),komal(\".N \"),\" S \",komal(\" R \"),komal(\" G \"),\" M \",\" P \",komal(\" D \"),komal(\" N \"),\" S.\",komal(\" R.\"),komal(\" G.\"),\" M.\",\" P.\",komal(\" D.\"),komal(\" N.\"),\" S..\"],\n    'Bhairav thaat': [\".S \",komal(\".R \"),\".G \",\".M \",\".P \",komal(\".D \"),\".N \",\" S \",komal(\" R \"),\" G \",\" M \",\" P \",komal(\" D \"),\" N \",\" S.\",komal(\" R.\"),\" G.\",\" M.\",\" P.\",komal(\" D.\"),\" N.\",\" S..\"],\n    'Marwa thaat': [\".S \",komal(\".R \"),\".G \",\".M' \",\".P \",\".D \",\".N \",\" S \",komal(\" R \"),\" G \",\" M' \",\" P \",\" D \",\" N \",\" S.\",komal(\" R.\"),\" G.\",\" M'.\",\" P.\",\" D.\",\" N.\",\" S..\"],\n    'Purvi thaat': [\".S \",komal(\".R \"),\".G \",\".M' \",\".P \",komal(\".D \"),\".N \",\" S \",komal(\" R \"),\" G \",\" M' \",\" P \",komal(\" D \"),\" N \",\" S.\",komal(\" R.\"),\" G.\",\" M'.\",\" P.\",komal(\" D.\"),\" N.\",\" S..\"],\n    'Todi thaat': [\".S \",komal(\".R \"),komal(\".G \"),\".M' \",\".P \",komal(\".D \"),\".N \",\" S \",komal(\" R \"),komal(\" G \"),\" M' \",\" P \",komal(\" D \"),\" N \",\" S.\",komal(\" R.\"),komal(\" G.\"),\" M'.\",\" P.\",komal(\" D.\"),\" N.\",\" S..\"],\n}\n    \napp_ui = ui.page_fluid(\n    ui.page_sidebar(\n        ui.sidebar(\n            ui.input_select(\"swar_script\", \"Swar Notation using:\", choices=[\"Devanagri Simplified\", \"Devanagri\", \"Latin\"]),\n            ui.input_numeric(\"formula_aroha\", \"Formula?\", value=1234, min=1, max=10e10),\n            ui.input_slider(\"font_size\", \"Font Size\", min=10, max=30, value=20),\n            ui.div(\n                # ui.span(\"Light or Dark mode \"),\n                ui.input_dark_mode(mode=\"light\"),\n            ),\n            ui.accordion(\n                ui.accordion_panel(\n                    \"More Options\",\n                    ui.input_select(\"thaat\", \"Thaat:\", choices=list(THAAT_SWAR_DEVANAGRI_DICT.keys()), selected=\"Bilawal thaat\"),\n                    ui.input_select(\"first_note\", \"First Note:\", choices=[]),\n                    ui.input_select(\"last_note\", \"Last Note:\", choices=[]),\n                    ui.input_switch(\"aroha_avaroha_flag\", \"Aroha and Avaroha same formula?\", value=True),\n                    ui.output_ui(\"conditional_input\"),\n                    \n                ),\n                open=False  # Initially collapsed\n            ),\n        ),\n        ui.output_ui(\"display_notation\"),\n        title=\"Paltan Practise Generator\",\n    )\n)\n\n\ndef get_all_substrings(input_string, formula):\n    max_digit = max([int(i) for i in formula])# find the max digit for last phrase\n    text = \"\"\n    for start_index in range(0, len(input_string) - max_digit + 1):\n        for i in formula:\n            text += input_string[start_index + int(i) - 1] + \" \"\n        text += \"<br>\"\n    return text\n\ndef server(input, output, session):\n    @reactive.Effect\n    def update_swar_choices_first_note():\n        thaat = input.thaat()\n        if input.swar_script() == \"Devanagri Simplified\":\n            thaat_swar = THAAT_SWAR_DEVANAGRI_SIMPLIFIED_DICT[thaat]\n            default_first_note = \".\u092a \"\n        elif input.swar_script() == \"Devanagri\":\n            thaat_swar = THAAT_SWAR_DEVANAGRI_DICT[thaat]\n            default_first_note = \".\u092a \"\n        else:\n            thaat_swar = THAAT_SWAR_LATIN_DICT[thaat]\n            default_first_note = \".P \"\n        ui.update_select(\"first_note\", choices=[ui.HTML(note) for note in thaat_swar], selected=default_first_note)\n    \n    @reactive.Effect\n    def update_swar_choices_last_note():\n        thaat = input.thaat()\n        if input.swar_script() == \"Devanagri Simplified\":\n            thaat_swar = THAAT_SWAR_DEVANAGRI_SIMPLIFIED_DICT[thaat]\n            default_last_note = \" \u092a.\"\n        elif input.swar_script() == \"Devanagri\":\n            thaat_swar = THAAT_SWAR_DEVANAGRI_DICT[thaat]\n            default_last_note = \" \u092a.\"\n        else:\n            thaat_swar = THAAT_SWAR_LATIN_DICT[thaat]\n            default_last_note = \" P.\"\n        first_note = input.first_note()\n        if first_note in thaat_swar:\n            swar_choices_last_note = thaat_swar[thaat_swar.index(first_note)+1:]\n        else:\n            swar_choices_last_note = thaat_swar\n        ui.update_select(\"last_note\", choices=swar_choices_last_note, selected=default_last_note)\n        \n    @output\n    @render.ui\n    def conditional_input():\n        if not input.aroha_avaroha_flag():\n            return ui.input_numeric(\"formula_avaroha\", \"Avaroha Formula?\", value=1234, min=1, max=10e10)\n        return None\n    \n    @output\n    @render.ui\n    def display_notation():\n        thaat = input.thaat()\n        font_size = input.font_size()\n        first_note = input.first_note()\n        last_note = input.last_note()\n        if input.swar_script() == \"Devanagri Simplified\":\n            title = {'aroha_heading': \"* \u0906\u0930\u094b\u0939 *\",\n                     'avaroha_heading': \"* \u0905\u0935\u0930\u094b\u0939 *\"}\n            swar_devanagri_simplified = THAAT_SWAR_DEVANAGRI_SIMPLIFIED_DICT[thaat]\n            if first_note in swar_devanagri_simplified:\n                swar = swar_devanagri_simplified[swar_devanagri_simplified.index(first_note):swar_devanagri_simplified.index(last_note)+1]\n            else:\n                swar = swar_devanagri_simplified\n        elif input.swar_script() == \"Devanagri\":\n            title = {'aroha_heading': \"* \u0906\u0930\u094b\u0939 *\",\n                     'avaroha_heading': \"* \u0905\u0935\u0930\u094b\u0939 *\"}\n            swar_devanagri = THAAT_SWAR_DEVANAGRI_DICT[thaat]\n            if first_note in swar_devanagri:\n                swar = swar_devanagri[swar_devanagri.index(first_note):swar_devanagri.index(last_note)+1]\n            else:\n                swar = swar_devanagri\n        else:\n            title = {'aroha_heading': \"* Aroha *\",\n                     'avaroha_heading': \"* Avaroha *\"}\n            swar_latin = THAAT_SWAR_LATIN_DICT[thaat]\n            if first_note in swar_latin:\n                swar = swar_latin[swar_latin.index(first_note):swar_latin.index(last_note)+1]\n            else:\n                swar = swar_latin\n            \n        if input.aroha_avaroha_flag():\n            aroha_text = get_all_substrings(swar, str(input.formula_aroha()))\n            avaroha_text = get_all_substrings(swar[::-1], str(input.formula_aroha()))\n        else:\n            aroha_text = get_all_substrings(swar, str(input.formula_aroha()))\n            avaroha_text = get_all_substrings(swar[::-1], str(input.formula_avaroha()))\n        \n        combined_output = f\"\"\"\n                        <div style=\"display: flex; justify-content: center; font-size: {font_size}px;\">\n                            <div style=\"flex: 1; padding: 10px; text-align: center; border: 1px solid black; margin-right: 10px;\">\n                                {f\"<b style='font-size: {font_size+2}px;'>{title['aroha_heading']}</b><br><br>\"}\n                                {aroha_text}\n                            </div>\n                            <div style=\"flex: 1; padding: 10px; text-align: center; border: 1px solid black; margin-left: 10px;\">\n                                {f\"<b style='font-size: {font_size+2}px;'>{title['avaroha_heading']}</b><br><br>\"}\n                                {avaroha_text}\n                            </div>\n                        </div>\n                        \"\"\"\n        return ui.HTML(combined_output)\n\napp = App(app_ui, server)", "type": "text"}]