[{"name": "app.py", "content": "from shiny import App, reactive, render, ui\n\n# TODO Background color spacegray\n# TODO Add Bhatkhande Notation\n\nSWAR_DEVANAGRI = [\n    \".\u0938\u093e \",\n    \".\u0930\u0947 \",\n    \".\u0917\u093e \",\n    \".\u092e \",\n    \".\u092a \",\n    \".\u0927 \",\n    \".\u0928\u093f \",\n    \" \u0938\u093e \",\n    \" \u0930\u0947 \",\n    \" \u0917\u093e \",\n    \" \u092e \",\n    \" \u092a \",\n    \" \u0927 \",\n    \" \u0928\u093f \",\n    \" \u0938\u093e.\",\n    \" \u0930\u0947.\",\n    \" \u0917\u093e.\",\n    \" \u092e.\",\n    \" \u092a.\",\n    \" \u0927.\",\n    \" \u0928\u093f.\",\n    \" \u0938\u093e..\",\n]\n\nSWAR_LATIN = [\n    \".S \",\n    \".R \",\n    \".G \",\n    \".M \",\n    \".P \",\n    \".D \",\n    \".N \",\n    ' S ',\n    ' R ',\n    ' G ',\n    ' M ',\n    ' P ',\n    ' D ',\n    ' N ',\n    \" S.\",\n    \" R.\",\n    \" G.\",\n    \" M.\",\n    \" P.\",\n    \" D.\",\n    \" N.\",\n    \" S..\",\n]\n\napp_ui = ui.page_fluid(\n    ui.page_sidebar(\n    ui.sidebar(\n        ui.input_select(\"swar_script\", \"Swar Notation using:\", choices=[\"Devanagri script\", \"Latin script\"]),\n        \n        ui.input_select(\"first_note\", \"First Note:\", choices=[]),\n        ui.input_select(\"last_note\", \"Last Note:\", choices=[]),\n        \n        ui.input_numeric(\"formula_aroha\", \"Formula?\", value=1234, min=1, max=10e10),\n        ui.input_switch(\"aroha_avaroha_flag\", \"Aroha and Avaroha same formula?\", value=True),\n        ui.output_ui(\"conditional_input\"),\n        ui.input_slider(\"font_size\", \"Font Size\", min=10, max=30, value=20),\n        ui.div(\n            ui.span(\"Light or Dark mode \"),\n            ui.input_dark_mode(),\n        ),\n    ),\n    ui.output_ui(\"display_notation\"),\n    title=\"Paltan Practise Generator (Alankar Long Notation)\",\n))\n\n\ndef get_all_substrings(input_string, formula):\n    max_digit = max([int(i) for i in formula])# find the max digit for last phrase\n\n    text = \"\"\n    for start_index in range(0, len(input_string) - max_digit + 1):\n        for i in formula:\n            text += input_string[start_index + int(i) - 1] + \" \"\n        text += \"<br>\"\n    return text\n\ndef server(input, output, session):\n    @reactive.Effect\n    def update_swar_choices_first_note():\n        if input.swar_script() == \"Devanagri script\":\n            swar_choices = SWAR_DEVANAGRI\n            default_first_note = \".\u092a \"\n        else:\n            swar_choices = SWAR_LATIN\n            default_first_note = \".P \"\n        ui.update_select(\"first_note\", choices=swar_choices, selected=default_first_note)\n    \n    @reactive.Effect\n    def update_swar_choices_last_note():\n        if input.swar_script() == \"Devanagri script\":\n            swar_choices = SWAR_DEVANAGRI\n            default_last_note = \" \u092a.\"\n        else:\n            swar_choices = SWAR_LATIN\n            default_last_note = \" P.\"\n        \n        first_note = input.first_note()\n        if first_note in swar_choices:\n            swar_choices_last_note = swar_choices[swar_choices.index(first_note)+1:]\n        else:\n            swar_choices_last_note = swar_choices\n        ui.update_select(\"last_note\", choices=swar_choices_last_note, selected=default_last_note)\n        \n    @output\n    @render.ui\n    def conditional_input():\n        if not input.aroha_avaroha_flag():\n            return ui.input_numeric(\"formula_avaroha\", \"Avaroha Formula?\", value=1234, min=1, max=10e10)\n        return None\n    \n    @output\n    @render.ui\n    def display_notation():\n        font_size = input.font_size()\n        if input.swar_script() == \"Devanagri script\":\n            title = {'aroha_heading': \"* \u0906\u0930\u094b\u0939 *\",\n                     'avaroha_heading': \"* \u0905\u0935\u0930\u094b\u0939 *\"}\n            swar = SWAR_DEVANAGRI[SWAR_DEVANAGRI.index(str(input.first_note())):SWAR_DEVANAGRI.index(str(input.last_note()))+1]\n        else:\n            title = {'aroha_heading': \"* Aroha *\",\n                     'avaroha_heading': \"* Avaroha *\"}\n            swar = SWAR_LATIN[SWAR_LATIN.index(str(input.first_note())):SWAR_LATIN.index(str(input.last_note()))+1]\n            \n        if input.aroha_avaroha_flag():\n            aroha_text = get_all_substrings(swar, str(input.formula_aroha()))\n            avaroha_text = get_all_substrings(swar[::-1], str(input.formula_aroha()))\n        else:\n            aroha_text = get_all_substrings(swar, str(input.formula_aroha()))\n            avaroha_text = get_all_substrings(swar[::-1], str(input.formula_avaroha()))\n        \n        combined_output = f\"\"\"\n                        <div style=\"display: flex; justify-content: center; font-size: {font_size}px;\">\n                            <div style=\"flex: 1; padding: 10px; text-align: center; border: 1px solid black; margin-right: 10px;\">\n                                {f\"<b style='font-size: {font_size+2}px;'>{title['aroha_heading']}</b><br><br>\"}\n                                {aroha_text}\n                            </div>\n                            <div style=\"flex: 1; padding: 10px; text-align: center; border: 1px solid black; margin-left: 10px;\">\n                                {f\"<b style='font-size: {font_size+2}px;'>{title['avaroha_heading']}</b><br><br>\"}\n                                {avaroha_text}\n                            </div>\n                        </div>\n                        \"\"\"\n        return ui.HTML(combined_output)\n\n\napp = App(app_ui, server)\n#app.run()\n", "type": "text"}]